<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.base.pj.dao.PJ4700PDAO">

	<select id="select01" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			  '0'	AS CHK
			, ''	AS ROWFLAG
			, A.RPPR_ID
			, A.RPPR_NO
			, A.RPPR_NAME
			, A.RPPR_TYPE_CD
			, A.PJT_ID
			, A.BIZ_ID
			, A.PERIOD
			, A.RPPR_DESC
			, A.REMARK
			, A.PLAN_SDATE
			, A.PLAN_EDATE
			, A.ACTL_SDATE
			, A.ACTL_EDATE
			, A.CHG_USER_NM
			, A.DEV_USER_ID
			, A.DEV_USER_NM
			, A.DEV_USER_DEPT
			, A.PL_USER_ID
			, A.PL_USER_NM
			, A.PL_USER_DEPT
			, A.REG_STIME
			, A.REG_USER_ID
			, A.REG_USER_NM
			, A.REG_USER_DEPT
			, A.LMOD_SDATE
			, A.LMOD_USER_ID
			, A.LMOD_USER_NM
			, A.LMOD_USER_DEPT
			, B.PJT_NAME AS PJT_NAME
			, C.PJT_ID   AS P_PJT_ID 
			, C.PJT_NAME AS P_PJT_NAME

		FROM
			  PJ_RPTPRG A
			, PJ_PROJECT B
			, PJ_PROJECT C

		WHERE 1 = 1
		AND A.PJT_ID	= B.PJT_ID
		AND B.PARENT_ID	= C.PJT_ID
		AND A.RPPR_ID	= #{RPPR_ID}
	</select>

	<select id="select02" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			  '0'		AS CHK
			, ''		AS ROWFLAG
			, A.RPPR_ID AS REF_ID
			, A.SCR_ID
			, B.SCR_NO
			, B.SCR_NAME
			, A.PJT_ID
			, A.REG_STIME
			, A.REG_USER_ID
			, A.REG_USER_NM
			, A.REG_USER_DEPT

		FROM
			  PJ_RPPR_SCR_MAP A
			, PJ_SCREEN B

		WHERE 1 = 1
		AND A.PJT_ID	= B.PJT_ID
		AND A.SCR_ID	= B.SCR_ID
		AND A.RPPR_ID	= #{RPPR_ID}
		<!-- AND A.PJT_ID	= #{SUB_PJT_ID} -->

		ORDER BY
			B.SCR_NO, B.SCR_ID
	</select>

	<select id="select03" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			  '0'		AS CHK
			, ''		AS ROWFLAG
			, A.RPPR_ID AS REF_ID
			, A.BTJB_ID
			, B.BTJB_NO
			, B.BTJB_NAME
			, A.PJT_ID
			, A.REG_STIME
			, A.REG_USER_ID
			, A.REG_USER_NM
			, A.REG_USER_DEPT

		FROM
			  PJ_RPPR_BTJB_MAP A
			, PJ_BATCHJOB B

		WHERE 1 = 1
		AND A.PJT_ID	= B.PJT_ID
		AND A.BTJB_ID	= B.BTJB_ID
		AND A.RPPR_ID	= #{RPPR_ID}

		ORDER BY
			B.BTJB_NO, B.BTJB_ID
	</select>

	<select id="select04" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			  '0'		AS CHK
			, ''		AS ROWFLAG
			, A.RPPR_ID AS REF_ID
			, A.FUNC_ID
			, B.FUNC_NO
			, B.FUNC_NAME
			, A.PJT_ID
			, A.REG_STIME
			, A.REG_USER_ID
			, A.REG_USER_NM
			, A.REG_USER_DEPT

		FROM
			  PJ_RPPR_FUNC_MAP A
			, PJ_FUNCTION B
		WHERE 1 = 1
		AND A.PJT_ID	= B.PJT_ID
		AND A.FUNC_ID	= B.FUNC_ID
		AND A.RPPR_ID	= #{RPPR_ID}

		ORDER BY
			B.FUNC_NO, B.FUNC_ID
	</select>

	<select id="select05" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			  '0'		AS CHK
			, ''		AS ROWFLAG
			, A.RPPR_ID AS REF_ID
			, A.REQ_ID
			, B.REQ_NO
			, B.REQ_NAME
			, A.PJT_ID
			, A.REG_STIME
			, A.REG_USER_ID
			, A.REG_USER_NM
			, A.REG_USER_DEPT

		FROM
			  PJ_RPPR_REQ_MAP A
			, PJ_REQMENT B

		WHERE 1 = 1
		AND A.PJT_ID	= B.PJT_ID
		AND A.REQ_ID	= B.REQ_ID
		AND A.RPPR_ID	= #{RPPR_ID}

		ORDER BY
			B.REQ_NO, B.REQ_ID
	</select>

	<insert id="insert01" parameterType="java.util.Map">
		<selectKey resultType="string" keyProperty="RPPR_ID" order="BEFORE">
			SELECT
				'PJRT' || TO_CHAR(SYSDATE, 'YYMMDD') ||
				LPAD( NVL(MAX(TO_NUMBER(NVL(SUBSTR(RPPR_ID, -6), 0) )), 0) + 1, 6, 0)
   			FROM PJ_RPTPRG
   			WHERE 1 = 1
   			AND RPPR_ID LIKE 'PJRT%'
			AND LENGTH(RPPR_ID) = 16
		</selectKey>

		INSERT INTO PJ_RPTPRG
		(  
			  RPPR_ID
			, RPPR_NO
			, RPPR_NAME
			, RPPR_TYPE_CD
			, PJT_ID
			, BIZ_ID
			, PERIOD
			, PLAN_SDATE
			, PLAN_EDATE
			, ACTL_SDATE
			, ACTL_EDATE
			, CHG_USER_NM
			, DEV_USER_ID
			, DEV_USER_NM
			, DEV_USER_DEPT
			, PL_USER_ID
			, PL_USER_NM
			, PL_USER_DEPT
			, RPPR_DESC
			, REMARK

			, REG_STIME
			, REG_USER_ID
			, REG_USER_NM
			, REG_USER_DEPT

			, LMOD_SDATE
			, LMOD_USER_ID
			, LMOD_USER_NM
			, LMOD_USER_DEPT
		)
		VALUES
		(
			  #{RPPR_ID}
			, #{RPPR_NO}
			, #{RPPR_NAME}
			, #{RPPR_TYPE_CD}
			, #{PJT_ID}
			, #{BIZ_ID}
			, #{PERIOD}
			, #{PLAN_SDATE}
			, #{PLAN_EDATE}
			, #{ACTL_SDATE}
			, #{ACTL_EDATE}
			, #{CHG_USER_NM}
			, #{DEV_USER_ID}
			, #{DEV_USER_NM}
			, #{DEV_USER_DEPT}
			, #{PL_USER_ID}
			, #{PL_USER_NM}
			, #{PL_USER_DEPT}
			, #{RPPR_DESC}
			, #{REMARK}

			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{LMID}
			, (SELECT USER_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
			, (SELECT DEPT_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})

			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{LMID}
			, (SELECT USER_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
			, (SELECT DEPT_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
		)
	</insert>

	<update id="modify01" parameterType="java.util.Map">
		UPDATE PJ_RPTPRG SET
			  RPPR_NO			= #{RPPR_NO}
            , RPPR_NAME			= #{RPPR_NAME}
            , RPPR_TYPE_CD		= #{RPPR_TYPE_CD}
            , BIZ_ID			= #{BIZ_ID}
            , PERIOD			= #{PERIOD}
            , PLAN_SDATE		= #{PLAN_SDATE}
            , PLAN_EDATE		= #{PLAN_EDATE}
            , ACTL_SDATE		= #{ACTL_SDATE}
            , ACTL_EDATE		= #{ACTL_EDATE}
            , CHG_USER_NM		= #{CHG_USER_NM}
            , DEV_USER_ID		= #{DEV_USER_ID}
            , DEV_USER_NM		= #{DEV_USER_NM}
            , DEV_USER_DEPT		= #{DEV_USER_DEPT}
            , PL_USER_ID		= #{PL_USER_ID}
            , PL_USER_NM		= #{PL_USER_NM}
            , PL_USER_DEPT		= #{PL_USER_DEPT}
            , RPPR_DESC			= #{RPPR_DESC}
            , REMARK			= #{REMARK}

            , LMOD_SDATE		= TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, LMOD_USER_ID		= #{LMID}														--최종수정자ID
			, LMOD_USER_NM		= (SELECT USER_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})	--최종수정자이름
			, LMOD_USER_DEPT	= (SELECT DEPT_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})	--최종수정자부서이름

		WHERE 1 = 1
		AND RPPR_NO	= #{RPPR_NO}			
	</update>

	<insert id="insert02" parameterType="java.util.Map">
		INSERT INTO PJ_RPPR_SCR_MAP
		(  
			  RPPR_ID
			, SCR_ID
			, PJT_ID

			, REG_STIME
			, REG_USER_ID
			, REG_USER_NM
			, REG_USER_DEPT
		)
		VALUES
		(
			  #{REF_ID}
			, #{SCR_ID}
			, #{PJT_ID}

			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{LMID}
			, (SELECT USER_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
			, (SELECT DEPT_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
		)
	</insert>

	<delete id="remove01" parameterType="java.util.Map">
		DELETE
		FROM PJ_RPPR_SCR_MAP
		WHERE 1 = 1
		AND RPPR_ID	= #{REF_ID}
		AND FUNC_ID	= #{FUNC_ID}
	</delete>

	<insert id="insert03" parameterType="java.util.Map">
		INSERT INTO PJ_RPPR_BTJB_MAP
		(  
			  RPPR_ID
			, BTJB_ID
			, PJT_ID

			, REG_STIME
			, REG_USER_ID
			, REG_USER_NM
			, REG_USER_DEPT
		)
		VALUES
		(
			  #{REF_ID}
			, #{BTJB_ID}
			, #{PJT_ID}

			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{LMID}
			, (SELECT USER_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
			, (SELECT DEPT_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
		)
	</insert>

	<delete id="remove02" parameterType="java.util.Map">
		DELETE
		FROM PJ_RPPR_BTJB_MAP
		WHERE 1 = 1
		AND RPPR_ID	= #{REF_ID}
		AND BTJB_ID	= #{BTJB_ID}
	</delete>

	<insert id="insert04" parameterType="java.util.Map">
		INSERT INTO PJ_RPPR_FUNC_MAP
		(  
			  RPPR_ID
			, FUNC_ID
			, PJT_ID

			, REG_STIME
			, REG_USER_ID
			, REG_USER_NM
			, REG_USER_DEPT
		)
		VALUES
		(
			  #{REF_ID}
			, #{FUNC_ID}
			, #{PJT_ID}

			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{LMID}
			, (SELECT USER_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
			, (SELECT DEPT_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
		)
	</insert>

	<delete id="remove03" parameterType="java.util.Map">
		DELETE
		FROM PJ_RPPR_FUNC_MAP
		WHERE 1 = 1
		AND RPPR_ID	= #{REF_ID}
		AND FUNC_ID	= #{FUNC_ID}
	</delete>

	<insert id="insert05" parameterType="java.util.Map">
		INSERT INTO PJ_RPPR_REQ_MAP
		(  
			  RPPR_ID
			, REQ_ID
			, PJT_ID

			, REG_STIME
			, REG_USER_ID
			, REG_USER_NM
			, REG_USER_DEPT
		)
		VALUES
		(
			  #{REF_ID}
			, #{REQ_ID}
			, #{PJT_ID}

			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{LMID}
			, (SELECT USER_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
			, (SELECT DEPT_NM FROM FOMM_USER_MT WHERE USER_ID = #{LMID})
		)
	</insert>

	<delete id="remove04" parameterType="java.util.Map">
		DELETE
		FROM PJ_RPPR_REQ_MAP
		WHERE 1 = 1
		AND RPPR_ID	= #{REF_ID}
		AND REQ_ID	= #{REQ_ID}
	</delete>

</mapper>