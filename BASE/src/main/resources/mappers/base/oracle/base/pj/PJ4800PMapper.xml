<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.base.pj.dao.PJ4800PDAO">

	<select id="select01" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT 
			  A.SCR_ID AS PRG_ID
			, A.SCR_NO AS PRG_NO
			, A.SCR_NAME AS PRG_NAME
			, A.SCR_TYPE_CD AS TYPE_CD
			, A.PJT_ID
			, A.BIZ_ID
			, D.BIZ_NAME
			, A.PLAN_SDATE
			, A.PLAN_EDATE
			, A.ACTL_SDATE
			, A.ACTL_EDATE
			, A.CHG_USER_NM
			, A.DEV_USER_ID
			, A.DEV_USER_NM
			, A.DEV_USER_DEPT
			, A.PL_USER_ID
			, A.PL_USER_NM
			, A.PL_USER_DEPT
			, A.SCR_DESC AS PRG_DESC
			, A.REMARK
			, B.PJT_NAME AS PJT_NAME
			, C.PJT_ID   AS P_PJT_ID 
			, C.PJT_NAME AS P_PJT_NAME

		FROM
			  PJ_SCREEN A
			, PJ_PROJECT B   
			, PJ_PROJECT C
			, PJ_BIZ D

		WHERE 1 = 1
		AND A.PJT_ID    = B.PJT_ID
		AND B.PARENT_ID = C.PJT_ID
		AND A.PJT_ID    = D.PJT_ID
		AND A.BIZ_ID    = D.BIZ_ID
		AND A.PJT_ID    = #{PJT_ID}
		AND A.BIZ_ID    = #{BIZ_ID}

		<choose>
			<when test='"SUM".equals(MODE)'>
		AND A.PLAN_EDATE <![CDATA[<=]]> #{BDATE}
        AND (
			A.ACTL_EDATE IS NULL OR
			A.ACTL_EDATE > #{BDATE}
            )
			</when>
			<when test='"WEEK".equals(MODE)'>
		AND A.PLAN_EDATE BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
        AND (
			A.ACTL_EDATE  IS NULL OR
			A.ACTL_EDATE NOT BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
             )
			</when>
		</choose>
		
		ORDER BY
			A.SCR_NO, A.SCR_ID
	</select>

	<select id="select02" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT 
			  A.INF_ID AS PRG_ID
			, A.INF_NO AS PRG_NO
			, A.INF_NAME AS PRG_NAME
			, A.INF_TYPE_CD AS TYPE_CD
			, A.PJT_ID
			, A.BIZ_ID
			, D.BIZ_NAME
			, A.PLAN_SDATE
			, A.PLAN_EDATE
			, A.ACTL_SDATE
			, A.ACTL_EDATE
			, A.CHG_USER_NM
			, A.DEV_USER_ID
			, A.DEV_USER_NM
			, A.DEV_USER_DEPT
			, A.PL_USER_ID
			, A.PL_USER_NM
			, A.PL_USER_DEPT
			, A.INF_DESC AS PRG_DESC
			, A.REMARK
			, B.PJT_NAME AS PJT_NAME
			, C.PJT_ID   AS P_PJT_ID 
			, C.PJT_NAME AS P_PJT_NAME

		FROM
			  PJ_INTERFACE A
			, PJ_PROJECT B
			, PJ_PROJECT C
			, PJ_BIZ D

		WHERE 1 = 1
		AND A.PJT_ID    = B.PJT_ID
		AND B.PARENT_ID = C.PJT_ID
		AND A.PJT_ID    = D.PJT_ID
		AND A.BIZ_ID    = D.BIZ_ID
		AND A.PJT_ID    = #{PJT_ID}
		AND A.BIZ_ID    = #{BIZ_ID}

		<choose>
			<when test='"SUM".equals(MODE)'>
		AND A.PLAN_EDATE <![CDATA[<=]]> #{BDATE}
        AND (
			A.ACTL_EDATE IS NULL OR
			A.ACTL_EDATE > #{BDATE}
            )
			</when>
			<when test='"WEEK".equals(MODE)'>
		AND A.PLAN_EDATE BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
        AND (
			A.ACTL_EDATE  IS NULL OR
			A.ACTL_EDATE NOT BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
             )
			</when>
		</choose>

		ORDER BY
			A.INF_NO, A.INF_ID
	</select>

	<select id="select03" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT 
			  A.BTPR_ID AS PRG_ID
			, A.BTPR_NO AS PRG_NO
			, A.BTPR_NAME AS PRG_NAME
			, A.BTPR_TYPE_CD AS TYPE_CD
			, A.PJT_ID
			, A.BIZ_ID
			, D.BIZ_NAME
			, A.PLAN_SDATE
			, A.PLAN_EDATE
			, A.ACTL_SDATE
			, A.ACTL_EDATE
			, A.CHG_USER_NM
			, A.DEV_USER_ID
			, A.DEV_USER_NM
			, A.DEV_USER_DEPT
			, A.PL_USER_ID
			, A.PL_USER_NM
			, A.PL_USER_DEPT
			, A.BTPR_DESC AS PRG_DESC
			, A.REMARK
			, B.PJT_NAME AS PJT_NAME
			, C.PJT_ID   AS P_PJT_ID 
			, C.PJT_NAME AS P_PJT_NAME

		FROM
			  PJ_BATCHPRG A
			, PJ_PROJECT B
			, PJ_PROJECT C
			, PJ_BIZ D

		WHERE 1 = 1
		AND A.PJT_ID    = B.PJT_ID
		AND B.PARENT_ID = C.PJT_ID
		AND A.PJT_ID    = D.PJT_ID
		AND A.BIZ_ID    = D.BIZ_ID
		AND A.PJT_ID    = #{PJT_ID}
		AND A.BIZ_ID    = #{BIZ_ID}

		<choose>
			<when test='"SUM".equals(MODE)'>
		AND A.PLAN_EDATE <![CDATA[<=]]> #{BDATE}
        AND (
			A.ACTL_EDATE IS NULL OR
			A.ACTL_EDATE > #{BDATE}
            )
			</when>
			<when test='"WEEK".equals(MODE)'>
		AND A.PLAN_EDATE BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
        AND (
			A.ACTL_EDATE  IS NULL OR
			A.ACTL_EDATE NOT BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
             )
			</when>
		</choose>

 		ORDER BY
 			A.BTPR_NO, A.BTPR_ID
	</select>

	<select id="select04" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT 
			  A.PRG_ID
			, A.PRG_NO
			, A.PRG_NAME
			, A.PRG_TYPE_CD	AS TYPE_CD
			, A.PJT_ID
			, A.BIZ_ID
			, D.BIZ_NAME
			, A.PLAN_SDATE
			, A.PLAN_EDATE
			, A.ACTL_SDATE
			, A.ACTL_EDATE
			, A.CHG_USER_NM
			, A.DEV_USER_ID
			, A.DEV_USER_NM
			, A.DEV_USER_DEPT
			, A.PL_USER_ID
			, A.PL_USER_NM
			, A.PL_USER_DEPT
			, A.PRG_DESC
			, A.REMARK
			, B.PJT_NAME AS PJT_NAME
			, C.PJT_ID   AS P_PJT_ID 
			, C.PJT_NAME AS P_PJT_NAME

		FROM
			  PJ_PROGRAM A
			, PJ_PROJECT B
			, PJ_PROJECT C
			, PJ_BIZ D

		WHERE 1 =1
		AND A.PJT_ID    = B.PJT_ID
		AND B.PARENT_ID = C.PJT_ID
		AND A.PJT_ID    = D.PJT_ID
		AND A.BIZ_ID    = D.BIZ_ID
		AND A.PJT_ID    = #{PJT_ID}
		AND A.BIZ_ID    = #{BIZ_ID}

		<choose>
			<when test='"SUM".equals(MODE)'>
		AND A.PLAN_EDATE <![CDATA[<=]]> #{BDATE}
        AND (
			A.ACTL_EDATE IS NULL OR
			A.ACTL_EDATE > #{BDATE}
            )
			</when>
			<when test='"WEEK".equals(MODE)'>
		AND A.PLAN_EDATE BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
        AND (
			A.ACTL_EDATE  IS NULL OR
			A.ACTL_EDATE NOT BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
             )
			</when>
		</choose>

		ORDER BY
			A.PRG_NO, A.PRG_ID
	</select>

	<select id="select05" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT 
			  A.RPPR_ID AS PRG_ID
			, A.RPPR_NO AS PRG_NO
			, A.RPPR_NAME AS PRG_NAME
			, A.RPPR_TYPE_CD AS TYPE_CD
			, A.PJT_ID
			, A.BIZ_ID
			, D.BIZ_NAME
			, A.PLAN_SDATE
			, A.PLAN_EDATE
			, A.ACTL_SDATE
			, A.ACTL_EDATE
			, A.CHG_USER_NM
			, A.DEV_USER_ID
			, A.DEV_USER_NM
			, A.DEV_USER_DEPT
			, A.PL_USER_ID
			, A.PL_USER_NM
			, A.PL_USER_DEPT
			, A.RPPR_DESC AS PRG_DESC
			, A.REMARK
			, B.PJT_NAME AS PJT_NAME
			, C.PJT_ID   AS P_PJT_ID 
			, C.PJT_NAME AS P_PJT_NAME

		FROM
			  PJ_RPTPRG A   
			, PJ_PROJECT B
			, PJ_PROJECT C
			, PJ_BIZ D

		WHERE 1 = 1
		AND A.PJT_ID    = B.PJT_ID
		AND B.PARENT_ID = C.PJT_ID
		AND A.PJT_ID    = D.PJT_ID
		AND A.BIZ_ID    = D.BIZ_ID
		AND A.PJT_ID    = #{PJT_ID}
		AND A.BIZ_ID    = #{BIZ_ID}

		<choose>
			<when test='"SUM".equals(MODE)'>
		AND A.PLAN_EDATE <![CDATA[<=]]> #{BDATE}
        AND (
			A.ACTL_EDATE IS NULL OR
			A.ACTL_EDATE > #{BDATE}
            )
			</when>
			<when test='"WEEK".equals(MODE)'>
		AND A.PLAN_EDATE BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
        AND (
			A.ACTL_EDATE  IS NULL OR
			A.ACTL_EDATE NOT BETWEEN (SELECT /* 일요일 계산 */TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD') + (1 - TO_CHAR(TO_DATE(#{BDATE},'YYYYMMDD'),'D')), 'YYYYMMDD') FROM DUAL) AND #{BDATE}
             )
			</when>
		</choose>

		ORDER BY
			A.RPPR_NO, A.RPPR_ID
	</select>

</mapper>