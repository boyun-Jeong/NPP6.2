<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.base.pj.dao.PJ1900WDAO">

	<select id="select01" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			  '0' AS CHK 
			, A.PJT_ID 
			, A.PJT_NAME
			, A.PJT_STATUS_CD 
			, A.PJT_DESC 
			, A.PJT_EXEC_CD 
			, A.IN_PM_USER_ID 
			, A.IN_PM_USER_NM 
			, A.IN_PM_DEPT 
			, A.OUT_PM_USER_ID 
			, A.OUT_PM_USER_NM 
			, A.OUT_CPY_ID 
			, A.OUT_CPY_NAME 
			, A.UPMU_USER_ID 
			, A.UPMU_USER_NM 
			, A.UPMU_USER_DEPT 
			, FN_GETDATEFORMAT('1', A.PJT_STIME) AS PJT_STIME 
			, FN_GETDATEFORMAT('1', A.PJT_ETIME) AS PJT_ETIME 
			, A.PJT_TYPE_CD 
			, A.PJT_SIZE_CD 
			, A.PJT_DEV_CD 
			, A.PJT_STD_YN 
			, A.PJT_OPEN_DATE 
			, A.CONTRT_ID 
			, A.DEV_AMOUNT 
			, A.DEV_MM 
			, A.HW_AMOUNT 
			, A.SW_AMOUNT 
			, A.TOT_AMOUNT 
			, A.REG_STIME 
			, A.REG_USER_ID 
			, A.REG_USER_NM 
			, A.REG_USER_DEPT 
			, A.SYSMODTIME 
			, A.LMOD_USER_ID 
			, A.LMOD_USER_NM 
			, A.LMOD_USER_DEPT 
			, A.CONTRACT_ID 
			, A.CONTRACT_NO 
			, A.OUT_PM_DEPT 
			, A.SUB_PJT_NO 
			, A.SUB_PJT_YN 
			, A.PARENT_ID 
			, A.WEIGHT 
			, A.PJT_NAME AS ORG_PJT_NAME
			, (SELECT ROUND(AVG(QA_ITEM_VALUE), 1) FROM PJ_QA_RST WHERE A.PJT_ID = PJT_ID) AS EVAL_SCORE

		FROM
			PJ_PROJECT A

		WHERE 1 = 1
		AND DECODE(A.SUB_PJT_YN, 'Y', 'Y', 'N') <![CDATA[<>]]> 'Y'
		AND A.PJT_STATUS_CD IN ('PROC_STS_CD02', 'PROC_STS_CD03') /* 프로젝트 상태코드 등록, 종료 */

		<if test="PJT_NAME != '' and PJT_NAME != null">
		AND UPPER(A.PJT_NAME) LIKE UPPER('%' || #{PJT_NAME} || '%')
		</if>

		<if test="OUT_CPY_NAME != '' and OUT_CPY_NAME != null">
		AND UPPER(A.OUT_CPY_NAME) LIKE UPPER('%' || #{OUT_CPY_NAME} || '%')
		</if>    
    	
    	AND SUBSTR(A.PJT_ETIME, 1, 4) = #{PJT_YEAR}

 		ORDER BY
 			NVL(A.SUB_PJT_NO, 0), A.PJT_NAME
	</select>

</mapper>