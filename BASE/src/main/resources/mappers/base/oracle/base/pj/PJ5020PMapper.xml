<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.base.pj.dao.PJ5020PDAO">

	<select id="select01" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			  A.UTEST_ID
			, A.UTEST_NO
			, A.UTEST_NAME
			, A.UTEST_TYPE_CD
			, A.PJT_ID
			, A.BIZ_ID
			, A.BIZ_NAME
			, A.RESULT_CD
			, A.PRG_REF_CD
			, A.PRG_REF_ID
			, A.PRG_REF_NO
			, A.PRG_REF_NAME
			, A.DEV_USER_ID
			, A.DEV_USER_NM
			, A.DEV_USER_DEPT
			, A.DEV_TEST_PDATE
			, A.DEV_TEST_ADATE
			, A.TESTER_ID
			, A.TESTER_NM
			, A.TESTER_DEPT
			, A.TESTER_PDATE
			, A.TESTER_ADATE
			, A.REG_STIME
			, A.REG_USER_ID
			, A.REG_USER_NM
			, A.REG_USER_DEPT
			, A.LMOD_SDATE
			, A.LMOD_USER_ID
			, A.LMOD_USER_NM
			, A.LMOD_USER_DEPT
			, A.PJT_NAME
			, A.P_PJT_ID 
			, A.P_PJT_NAME

		FROM
			(
			SELECT 
				  A.UTEST_ID
				, A.UTEST_NO
				, A.UTEST_NAME
				, A.UTEST_TYPE_CD
				, A.PJT_ID
				, A.BIZ_ID
				, D.BIZ_NAME
				, A.RESULT_CD
				, A.PRG_REF_CD
				, A.PRG_REF_ID
				, CASE WHEN A.PRG_REF_CD = 'TEST_TARG_CD01' THEN E.SCR_NO
				       WHEN A.PRG_REF_CD = 'TEST_TARG_CD02' THEN F.RPPR_NO
				       WHEN A.PRG_REF_CD = 'TEST_TARG_CD03' THEN G.INF_NO
				       WHEN A.PRG_REF_CD = 'TEST_TARG_CD04' THEN H.BTPR_NO
				       ELSE ''
				  END AS PRG_REF_NO
				, CASE WHEN A.PRG_REF_CD = 'TEST_TARG_CD01' THEN E.SCR_NAME
				       WHEN A.PRG_REF_CD = 'TEST_TARG_CD02' THEN F.RPPR_NAME
				       WHEN A.PRG_REF_CD = 'TEST_TARG_CD03' THEN G.INF_NAME
				       WHEN A.PRG_REF_CD = 'TEST_TARG_CD04' THEN H.BTPR_NAME
				       ELSE ''
				  END AS PRG_REF_NAME
				, A.DEV_USER_ID
				, A.DEV_USER_NM
				, A.DEV_USER_DEPT
				, A.DEV_TEST_PDATE
				, A.DEV_TEST_ADATE
				, A.TESTER_ID
				, A.TESTER_NM
				, A.TESTER_DEPT
				, A.TESTER_PDATE
				, A.TESTER_ADATE
				, A.REG_STIME
				, A.REG_USER_ID
				, A.REG_USER_NM
				, A.REG_USER_DEPT
				, A.LMOD_SDATE
				, A.LMOD_USER_ID
				, A.LMOD_USER_NM
				, A.LMOD_USER_DEPT
				, B.PJT_NAME AS PJT_NAME
				, C.PJT_ID   AS P_PJT_ID 
				, C.PJT_NAME AS P_PJT_NAME

			FROM
				  PJ_UNIT_TEST A
				, PJ_PROJECT B
				, PJ_PROJECT C
				, PJ_BIZ D
				, PJ_SCREEN E
				, PJ_RPTPRG F
				, PJ_INTERFACE G
				, PJ_BATCHPRG H

			WHERE 1 = 1
			AND A.PJT_ID		= B.PJT_ID
            AND B.PARENT_ID		= C.PJT_ID
            AND A.PJT_ID		= D.PJT_ID
            AND A.BIZ_ID		= D.BIZ_ID
            AND A.PRG_REF_ID	= E.SCR_ID(+)
            AND A.PJT_ID		= E.PJT_ID(+)
            AND A.PRG_REF_ID	= F.RPPR_ID(+)
            AND A.PJT_ID		= F.PJT_ID(+)
            AND A.PRG_REF_ID	= G.INF_ID(+)
            AND A.PJT_ID		= G.PJT_ID(+)
            AND A.PRG_REF_ID	= H.BTPR_ID(+)
            AND A.PJT_ID		= H.PJT_ID(+)
            AND A.PJT_ID		= #{SUB_PJT_ID}

			<if test="BIZ_ID != '' and BIZ_ID != null">
			AND A.BIZ_ID	= #{BIZ_ID}
			</if>
	
			<if test="UTEST_NO != '' and UTEST_NO != null">
			AND UPPER(A.UTEST_NO) LIKE '%' || UPPER(#{UTEST_NO}) || '%'
			</if>
	
			<if test="UTEST_NM != '' and UTEST_NM != null">
			AND UPPER(A.UTEST_NAME) LIKE '%' || UPPER(#{UTEST_NM}) || '%'
			</if>
	
			<if test="PRG_REF_CD != '' and PRG_REF_CD != null">
			AND A.PRG_REF_CD	= #{PRG_REF_CD}
			</if>
			) A

		WHERE 1 = 1
		<if test="PRG_REF_NO != '' and PRG_REF_NO != null">
		AND UPPER(A.PRG_REF_NO) LIKE '%' || UPPER(#{PRG_REF_NO}) || '%'
		</if>
		
		<if test="PRG_REF_NM != '' and PRG_REF_NM != null">
		AND UPPER(A.PRG_REF_NAME) LIKE '%' || UPPER(#{PRG_REF_NM}) || '%'
		</if>

		ORDER BY
			A.UTEST_NO, A.UTEST_ID
	</select>

</mapper>